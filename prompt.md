# 載入圖示 (Spinner) 問題的解決歷程

本節記錄了針對應用程式中 AI 模型載入時，載入圖示顯示問題的討論與解決過程。

## 問題描述

用戶在應用程式執行時，觀察到 AI 模型加載中時，除了預期的旋轉圖示，還會短暫出現帶有文字 ("load...") 的黑色長方形背景。用戶希望只顯示一個純粹的旋轉動畫，沒有任何文字或黑色背景。

## 解決歷程

### 嘗試 1：調整 `@st.cache_resource` 裝飾器的 `show_spinner` 參數

*   **初始設定**：`@st.cache_resource(show_spinner="正在載入 AI 偵測模型...")`
*   **修改方向**：將 `show_spinner` 參數設定為 `True`，期望能顯示一個預設的、較為簡潔的旋轉圖示。
*   **結果**：用戶回報仍看到「load 的字樣」以及「黑色長方形一閃而過」。確認 `show_spinner=True` 會顯示 Streamlit 預設的 "Running..." 或 "Loading..." 等文字。

### 嘗試 2：透過 CSS 隱藏預設圖示的文字和背景

*   **分析**：由於 Streamlit 預設圖示的行為無法直接透過 `show_spinner` 完全控制，考慮透過注入自訂 CSS 來隱藏文字和背景。
*   **修改方向**：在 `<style>` 區塊中加入 CSS 規則，針對 `[data-testid="stSpinner"]` 容器及其子元素，設定 `display: none !important;` 隱藏文字，並將背景設為 `transparent`。
*   **結果**：用戶回報「有只剩下圈圈了 但圈圈的背景是黑色正方形」。表示文字被隱藏，但旋轉圖示本身仍帶有黑色背景。

### 嘗試 3：進一步細化 CSS 規則，使旋轉圖示背景透明

*   **分析**：確認黑色背景來自旋轉圖示元素本身。
*   **修改方向**：加入更精確的 CSS 規則 `[data-testid="stSpinner"] > div > div:first-child { background: transparent !important; }`，直接針對旋轉圖示的背景進行透明化。
*   **結果**：用戶回報「還是有，那個背景如何產生的」。表示黑色背景依然存在，CSS 覆蓋無效。這暗示 Streamlit 生成該背景的方式具有極高的優先級或複雜性，難以透過常規 CSS 覆蓋。

### 最終解決方案：從零打造客製化旋轉動畫

*   **分析**：既然無法有效修改 Streamlit 的預設圖示，決定完全繞過它，手動實現一個自訂的載入動畫。
*   **修改方向**：
    1.  將 `@st.cache_resource` 裝飾器的 `show_spinner` 參數明確設定為 `False`，徹底禁用 Streamlit 的預設載入行為。
    2.  在 `<style>` 區塊中定義純 CSS 的旋轉動畫（`.custom-loader` 及 `@keyframes spin`），該動畫只是一個旋轉的圓環，沒有任何背景。
    3.  在應用程式的 Python 邏輯中，使用 `st.empty()` 創建一個佔位符。在模型載入前，將客製化旋轉動畫的 HTML 注入該佔位符；模型載入完成後，清除該佔位符。
*   **結果**：用戶回報「太完美了！」，成功解決問題，實現了只有純粹旋轉動畫的效果。
